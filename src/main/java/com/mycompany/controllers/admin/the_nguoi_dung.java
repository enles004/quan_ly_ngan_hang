/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JInternalFrame.java to edit this template
 */
package com.mycompany.controllers.admin;

import com.mycompany.db;
import com.mycompany.models.AccountGenerator;
import com.mycompany.models.loai_the_model;
import com.mycompany.models.loai_the_nguoi_dung;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;
import java.util.Vector;
import javax.swing.JOptionPane;
import javax.swing.plaf.basic.BasicInternalFrameUI;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author nobpe
 */
public class the_nguoi_dung extends javax.swing.JInternalFrame {

    /**
     * Creates new form the_nguoi_dung
     */
    public the_nguoi_dung() {
        this.setBorder(javax.swing.BorderFactory.createEmptyBorder(0,0,0,0));
        BasicInternalFrameUI ui = (BasicInternalFrameUI)this.getUI();
        ui.setNorthPane(null);
        initComponents();
        load();
        load_cb();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel3 = new javax.swing.JPanel();
        jScrollPane1 = new javax.swing.JScrollPane();
        tb_lt = new javax.swing.JTable();
        jPanel5 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        jPanel6 = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        sum_nd = new javax.swing.JLabel();
        tk = new javax.swing.JLabel();
        txt_tk = new javax.swing.JTextField();
        jPanel7 = new javax.swing.JPanel();
        jPanel8 = new javax.swing.JPanel();
        jten = new javax.swing.JLabel();
        jcccd = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        jlt = new javax.swing.JLabel();
        ten = new javax.swing.JTextField();
        cccd = new javax.swing.JTextField();
        sdt = new javax.swing.JTextField();
        stt = new javax.swing.JTextField();
        so_tien = new javax.swing.JTextField();
        hsd = new javax.swing.JTextField();
        jst = new javax.swing.JLabel();
        jsotien = new javax.swing.JLabel();
        jhsd = new javax.swing.JLabel();
        jtt = new javax.swing.JLabel();
        lt = new javax.swing.JComboBox<>();
        tt = new javax.swing.JComboBox<>();
        jPanel2 = new javax.swing.JPanel();
        btn_them = new javax.swing.JButton();
        btn_sua = new javax.swing.JButton();
        btn_xoa = new javax.swing.JButton();

        setPreferredSize(new java.awt.Dimension(800, 699));

        jPanel3.setBackground(new java.awt.Color(255, 255, 255));
        jPanel3.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Bảng dữ liệu", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Segoe UI", 1, 12))); // NOI18N
        jPanel3.setMaximumSize(new java.awt.Dimension(454, 404));

        tb_lt.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        tb_lt.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        tb_lt.setMinimumSize(new java.awt.Dimension(0, 0));
        tb_lt.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tb_ltMouseClicked(evt);
            }
        });
        jScrollPane1.setViewportView(tb_lt);

        javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
        jPanel3.setLayout(jPanel3Layout);
        jPanel3Layout.setHorizontalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jScrollPane1)
        );
        jPanel3Layout.setVerticalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 282, Short.MAX_VALUE)
        );

        jPanel5.setBackground(new java.awt.Color(255, 204, 204));
        jPanel5.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        jPanel5.setMaximumSize(new java.awt.Dimension(635, 48));

        jLabel1.setBackground(new java.awt.Color(0, 0, 0));
        jLabel1.setFont(new java.awt.Font("Segoe UI", 1, 24)); // NOI18N
        jLabel1.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel1.setText("QUẢN LÝ THẺ NGƯỜI DÙNG");

        javax.swing.GroupLayout jPanel5Layout = new javax.swing.GroupLayout(jPanel5);
        jPanel5.setLayout(jPanel5Layout);
        jPanel5Layout.setHorizontalGroup(
            jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jLabel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        jPanel5Layout.setVerticalGroup(
            jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jLabel1, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 54, Short.MAX_VALUE)
        );

        jPanel6.setBackground(new java.awt.Color(255, 255, 255));
        jPanel6.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Tìm kiếm", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Segoe UI", 1, 12))); // NOI18N

        jLabel2.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLabel2.setText("Tổng số thẻ của ND:");

        sum_nd.setFont(new java.awt.Font("Segoe UI", 1, 18)); // NOI18N
        sum_nd.setForeground(new java.awt.Color(204, 0, 51));
        sum_nd.setText("jLabel3");

        txt_tk.setToolTipText("");
        txt_tk.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                txt_tkMouseClicked(evt);
            }
        });
        txt_tk.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txt_tkKeyReleased(evt);
            }
        });

        javax.swing.GroupLayout jPanel6Layout = new javax.swing.GroupLayout(jPanel6);
        jPanel6.setLayout(jPanel6Layout);
        jPanel6Layout.setHorizontalGroup(
            jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel6Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel2)
                .addGap(4, 4, 4)
                .addComponent(sum_nd, javax.swing.GroupLayout.PREFERRED_SIZE, 61, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(88, 88, 88)
                .addComponent(txt_tk, javax.swing.GroupLayout.PREFERRED_SIZE, 397, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(tk, javax.swing.GroupLayout.PREFERRED_SIZE, 33, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
        jPanel6Layout.setVerticalGroup(
            jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel6Layout.createSequentialGroup()
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(txt_tk)
                    .addComponent(tk, javax.swing.GroupLayout.PREFERRED_SIZE, 26, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jLabel2)
                        .addComponent(sum_nd)))
                .addContainerGap(7, Short.MAX_VALUE))
        );

        jPanel7.setBackground(new java.awt.Color(255, 255, 255));
        jPanel7.setBorder(javax.swing.BorderFactory.createTitledBorder(""));

        jPanel8.setBackground(new java.awt.Color(255, 255, 255));
        jPanel8.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Segoe UI", 1, 12))); // NOI18N

        jten.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        jten.setText("Tên chủ thẻ:");

        jcccd.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        jcccd.setText("Số CCCD:");

        jLabel5.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        jLabel5.setText("SĐT chủ thẻ:");

        jlt.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        jlt.setText("Loại thẻ:");

        ten.setEditable(false);

        cccd.setEditable(false);

        stt.setEditable(false);
        stt.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                sttActionPerformed(evt);
            }
        });

        so_tien.setEditable(false);
        so_tien.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                so_tienActionPerformed(evt);
            }
        });

        hsd.setEditable(false);

        jst.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        jst.setText("Số thẻ:");

        jsotien.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        jsotien.setText("Số tiền:");

        jhsd.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        jhsd.setText("Ngày hết hạn:");

        jtt.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        jtt.setText("Trạng thái:");

        tt.setEditable(true);
        tt.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "-Chọn trạng thái-", "Đang hoạt động", "Không hoạt động" }));
        tt.setEnabled(false);

        javax.swing.GroupLayout jPanel8Layout = new javax.swing.GroupLayout(jPanel8);
        jPanel8.setLayout(jPanel8Layout);
        jPanel8Layout.setHorizontalGroup(
            jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel8Layout.createSequentialGroup()
                .addContainerGap(45, Short.MAX_VALUE)
                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jten)
                    .addComponent(jcccd, javax.swing.GroupLayout.PREFERRED_SIZE, 70, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(ten)
                    .addComponent(cccd, javax.swing.GroupLayout.PREFERRED_SIZE, 140, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED, 52, Short.MAX_VALUE)
                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jlt)
                    .addComponent(jLabel5)
                    .addComponent(lt, 0, 142, Short.MAX_VALUE)
                    .addComponent(sdt))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED, 52, Short.MAX_VALUE)
                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jst)
                    .addComponent(jsotien)
                    .addComponent(stt, javax.swing.GroupLayout.DEFAULT_SIZE, 127, Short.MAX_VALUE)
                    .addComponent(so_tien))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED, 51, Short.MAX_VALUE)
                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jtt)
                    .addComponent(jhsd)
                    .addComponent(hsd)
                    .addComponent(tt, 0, 140, Short.MAX_VALUE))
                .addGap(35, 35, 35))
        );
        jPanel8Layout.setVerticalGroup(
            jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel8Layout.createSequentialGroup()
                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(jPanel8Layout.createSequentialGroup()
                        .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(jLabel5)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(sdt, javax.swing.GroupLayout.PREFERRED_SIZE, 35, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel8Layout.createSequentialGroup()
                        .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addGroup(jPanel8Layout.createSequentialGroup()
                                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addComponent(jlt)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(lt, javax.swing.GroupLayout.PREFERRED_SIZE, 35, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(jPanel8Layout.createSequentialGroup()
                                .addContainerGap(9, Short.MAX_VALUE)
                                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addGroup(jPanel8Layout.createSequentialGroup()
                                        .addComponent(jst)
                                        .addGap(6, 6, 6)
                                        .addComponent(stt))
                                    .addGroup(jPanel8Layout.createSequentialGroup()
                                        .addComponent(jhsd)
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                        .addComponent(hsd))
                                    .addGroup(jPanel8Layout.createSequentialGroup()
                                        .addComponent(jten)
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                        .addComponent(ten, javax.swing.GroupLayout.PREFERRED_SIZE, 35, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addGap(0, 0, Short.MAX_VALUE)))))
                        .addGap(18, 18, Short.MAX_VALUE)
                        .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addGroup(jPanel8Layout.createSequentialGroup()
                                .addGap(0, 0, Short.MAX_VALUE)
                                .addComponent(jcccd)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addComponent(cccd, javax.swing.GroupLayout.PREFERRED_SIZE, 35, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jPanel8Layout.createSequentialGroup()
                                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(jsotien)
                                    .addComponent(jtt))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(so_tien)
                                    .addComponent(tt))))))
                .addContainerGap(19, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout jPanel7Layout = new javax.swing.GroupLayout(jPanel7);
        jPanel7.setLayout(jPanel7Layout);
        jPanel7Layout.setHorizontalGroup(
            jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel8, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        jPanel7Layout.setVerticalGroup(
            jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel7Layout.createSequentialGroup()
                .addGap(0, 0, Short.MAX_VALUE)
                .addComponent(jPanel8, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
        );

        jPanel2.setBackground(new java.awt.Color(255, 255, 255));
        jPanel2.setBorder(javax.swing.BorderFactory.createTitledBorder(""));

        btn_them.setText("Thêm");
        btn_them.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_themActionPerformed(evt);
            }
        });

        btn_sua.setText("Sửa");
        btn_sua.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_suaActionPerformed(evt);
            }
        });

        btn_xoa.setText("Xóa");
        btn_xoa.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_xoaActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addGap(20, 20, 20)
                .addComponent(btn_them, javax.swing.GroupLayout.PREFERRED_SIZE, 115, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(37, 37, 37)
                .addComponent(btn_sua, javax.swing.GroupLayout.PREFERRED_SIZE, 121, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(35, 35, 35)
                .addComponent(btn_xoa, javax.swing.GroupLayout.DEFAULT_SIZE, 128, Short.MAX_VALUE)
                .addGap(330, 330, 330))
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btn_them, javax.swing.GroupLayout.PREFERRED_SIZE, 29, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btn_sua, javax.swing.GroupLayout.PREFERRED_SIZE, 29, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btn_xoa, javax.swing.GroupLayout.PREFERRED_SIZE, 29, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel5, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(jPanel3, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(jPanel6, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(jPanel7, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(jPanel5, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(3, 3, 3)
                .addComponent(jPanel6, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, 0)
                .addComponent(jPanel7, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, 0)
                .addComponent(jPanel3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, 0)
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, 0))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents
    Connection con;
    boolean check = false;
    private void load(){
        btn_sua.setVisible(false);
        btn_xoa.setVisible(false);
        sdt.setEnabled(false);
        lt.setEnabled(false);
        try {
            tb_lt.removeAll();
            con = db.connect();
            String sql = "select * "
                    + "from loai_the_nguoi_dung ltnd "
                    + "join loai_the lt on lt.id = ltnd.loai_the_id";
            Statement st = con.createStatement();
            ResultSet rs = st.executeQuery(sql);
            String[] td = {"ID", "Số điện thoại", "Tên thẻ", "Số thẻ", "Số tiền", "Ngày hết hạn", "Trạng thái", "Ngày tạo"};
            DefaultTableModel tb = new DefaultTableModel(td, 0){
                @Override
                public boolean isCellEditable(int row, int column) {
                    return false; // Không cho phép chỉnh sửa bất kỳ ô nào
                }
            };
            int sum = 0;
            while(rs.next()){
                sum ++;
                Vector v = new Vector();
                v.add(rs.getString("id"));
                v.add(rs.getString("so_dien_thoai_id"));
                v.add(rs.getString("ten_loai_the"));
                v.add(rs.getString("so_the"));
                v.add(rs.getString("so_tien"));
                v.add(rs.getString("ngay_het_han"));
                v.add(rs.getString("trang_thai"));
                v.add(rs.getString("ngay_tao"));
                tb.addRow(v);
            }
            sum_nd.setText(sum + "");
            tb_lt.setModel(tb);
            con.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    loai_the_nguoi_dung ltnd;
    private void tb_ltMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tb_ltMouseClicked
        check = true;
        lt.setEnabled(false);
        sdt.setEnabled(false);
        int i = tb_lt.getSelectedRow();
        btn_sua.setVisible(true);
        btn_xoa.setVisible(true);
        tt.setEnabled(true);
        DefaultTableModel tb = (DefaultTableModel)tb_lt.getModel();
        String id = tb.getValueAt(i, 0).toString();
        String sql = "select * from loai_the_nguoi_dung ltnd "
                + "join nguoi_dung nd on nd.so_dien_thoai = ltnd.so_dien_thoai_id "
                + "where ltnd.id = '"+id+"'";
        try {
            con = db.connect();
            Statement st = con.createStatement();
            ResultSet rs = st.executeQuery(sql);
            while(rs.next()){
                ten.setText(rs.getString("ho") +" "+ rs.getString("ten"));
                cccd.setText(rs.getString("so_cong_dan"));
                lt.setSelectedItem(tb.getValueAt(i, 2).toString());
                sdt.setText(tb.getValueAt(i, 1).toString());
                stt.setText(rs.getString("so_the"));
                so_tien.setText(rs.getString("so_tien"));
                hsd.setText(rs.getString("ngay_het_han"));
                tt.setSelectedItem(rs.getString("trang_thai"));
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
        ltnd = new loai_the_nguoi_dung();
        ltnd.setId(Integer.parseInt(id));
       
    }//GEN-LAST:event_tb_ltMouseClicked

    private void txt_tkMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_txt_tkMouseClicked
            tt.setSelectedItem("-Chọn trạng thái-");
            tt.setEnabled(false);
            ten.setText("");
            cccd.setText("");
            sdt.setText("");
            stt.setText("");
            so_tien.setText("");
            hsd.setText("");
            tt.setSelectedItem("-Chọn trạng thái-");
            lt.setSelectedItem("-Chọn loại thẻ-");
            lt.setEnabled(false);
            tt.setEnabled(false);
            sdt.setEnabled(false);
            btn_sua.setVisible(false);
            btn_xoa.setVisible(false);
    }//GEN-LAST:event_txt_tkMouseClicked
    Map<String, String> ltid = new HashMap<>();
    private void load_cb(){
        String sql = "select * from loai_the";
        lt.removeAllItems();
        lt.addItem("-Chọn loại thẻ-");
            try {
                con = db.connect();
                Statement st = con.createStatement();
                ResultSet rs = st.executeQuery(sql);
                while(rs.next()){
                    String id = rs.getString("id");
                    String ten_the = rs.getString("ten_loai_the");
                    lt.addItem(ten_the);  
                    ltid.put(id, ten_the);
                }

            } catch (Exception e) {
                e.printStackTrace();
            }
    }
    private void txt_tkKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txt_tkKeyReleased
        try {
            con = db.connect();
            Statement st = con.createStatement();
            String tim = txt_tk.getText().trim();
            String sql = "select * "
            + "from loai_the_nguoi_dung ltnd "
            + "join loai_the lt on lt.id = ltnd.loai_the_id "
            + "where ltnd.so_the like '"+tim+"%' or ltnd.so_dien_thoai_id like '"+tim+"%'";
            ResultSet rs = st.executeQuery(sql);
            String[] td = {"ID", "Số điện thoại", "Tên thẻ", "Số thẻ", "Số tiền", "Ngày hết hạn", "Trạng thái", "Ngày tạo"};
            DefaultTableModel tb = new DefaultTableModel(td, 0){
                @Override
                public boolean isCellEditable(int row, int column) {
                    return false; // Không cho phép chỉnh sửa bất kỳ ô nào
                }
            };
            while(rs.next()){
                Vector v = new Vector();
                v.add(rs.getString("id"));
                v.add(rs.getString("so_dien_thoai_id"));
                v.add(rs.getString("ten_loai_the"));
                v.add(rs.getString("so_the"));
                v.add(rs.getString("so_tien"));
                v.add(rs.getString("ngay_het_han"));
                v.add(rs.getString("trang_thai"));
                v.add(rs.getString("ngay_tao"));
                tb.addRow(v);
            }
            tb_lt.setModel(tb);
            con.close();
        } catch (Exception e){
            e.printStackTrace();
        }
    }//GEN-LAST:event_txt_tkKeyReleased
    private void btn_themActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_themActionPerformed
        btn_sua.setVisible(false);
        btn_xoa.setVisible(false);
        if(check == true){
            tt.setSelectedItem("-Chọn trạng thái-");
            tt.setEnabled(false);
            ten.setText("");
            cccd.setText("");
            sdt.setText("");
            stt.setText("");
            so_tien.setText("");
            hsd.setText("");
            tt.setSelectedItem("-Chọn trạng thái-");
            lt.setSelectedItem("-Chọn loại thẻ-");
            ltid.clear();
            load_cb();
            check = false;
        }
        if(!sdt.isEnabled()){
            sdt.setEnabled(true);
            lt.setEnabled(true);
            ltid.clear();
            load_cb();
            return;
        }
        try {
            con = db.connect();
            Statement st = con.createStatement();
            String loai_the = lt.getSelectedItem().toString();
            if(loai_the.equals("-Chọn loại thẻ-")){
                JOptionPane.showMessageDialog(this, "Chưa chọn loại thẻ.");
                return;
            }
            String loai_the_id = ltid.entrySet()
                        .stream()
                        .filter(entry -> entry.getValue().equals(loai_the))
                        .map(Map.Entry::getKey)
                        .findFirst()
                        .orElse(null);
            String so_dien_thoai = sdt.getText().trim();
            if(so_dien_thoai.isEmpty()){
                JOptionPane.showMessageDialog(this, "Số điện thoại không được để trống.");
                return;
            }
            String sql = "insert into loai_the_nguoi_dung (so_dien_thoai_id, loai_the_id, so_the, so_tien, ngay_het_han, trang_thai, ngay_tao)"
            + "values (N'"+so_dien_thoai+"', N'"+loai_the_id+"', '"+AccountGenerator.generateUniqueAccountNumber(con)+"', 0, DATEADD(YEAR, 5, GETDATE()), N'"+"Đang hoạt động"+"', getdate())";
            st.executeUpdate(sql);
            JOptionPane.showMessageDialog(this, "Thêm loại thẻ thành công.");
            load();
        } catch (Exception e){
            e.printStackTrace();
        }
        // TODO add your handling code here:
    }//GEN-LAST:event_btn_themActionPerformed

    private void btn_suaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_suaActionPerformed
        try {
            con = db.connect();
            String trang_thai = tt.getSelectedItem().toString();
            if(trang_thai.equals("-Chọn trạng thái-")){
                JOptionPane.showMessageDialog(this, "Bạn đang chọn nhầm trạng thái.");
                return;
            }
            String sql = "Update loai_the_nguoi_dung Set trang_thai = N'"+trang_thai+"' "
            + "where id = '"+ltnd.getId()+"'";
            Statement st = con.createStatement();
            st.executeUpdate(sql);
            JOptionPane.showMessageDialog(this, "Bạn đã cập nhật thành công");
            con.close();
            load();
        } catch (Exception ex) {
            ex.printStackTrace();
        }
    }//GEN-LAST:event_btn_suaActionPerformed

    private void btn_xoaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_xoaActionPerformed
        try {
            con = db.connect();
            Statement st = con.createStatement();
            String sql = "Delete from loai_the_nguoi_dung "
            + "where id = '"+ltnd.getId()+"'";
            int r = JOptionPane.showConfirmDialog(this, "Bạn có muốn xóa loại thẻ người dùng này không?", "Xác nhận", JOptionPane.YES_NO_OPTION, JOptionPane.QUESTION_MESSAGE);
            if(r == JOptionPane.YES_OPTION){
                st.executeUpdate(sql);
                JOptionPane.showMessageDialog(this, "Xóa thành công!!");
                con.close();
            }
            load();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }//GEN-LAST:event_btn_xoaActionPerformed

    private void so_tienActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_so_tienActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_so_tienActionPerformed

    private void sttActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_sttActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_sttActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btn_sua;
    private javax.swing.JButton btn_them;
    private javax.swing.JButton btn_xoa;
    private javax.swing.JTextField cccd;
    private javax.swing.JTextField hsd;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JPanel jPanel6;
    private javax.swing.JPanel jPanel7;
    private javax.swing.JPanel jPanel8;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JLabel jcccd;
    private javax.swing.JLabel jhsd;
    private javax.swing.JLabel jlt;
    private javax.swing.JLabel jsotien;
    private javax.swing.JLabel jst;
    private javax.swing.JLabel jten;
    private javax.swing.JLabel jtt;
    private javax.swing.JComboBox<String> lt;
    private javax.swing.JTextField sdt;
    private javax.swing.JTextField so_tien;
    private javax.swing.JTextField stt;
    private javax.swing.JLabel sum_nd;
    private javax.swing.JTable tb_lt;
    private javax.swing.JTextField ten;
    private javax.swing.JLabel tk;
    private javax.swing.JComboBox<String> tt;
    private javax.swing.JTextField txt_tk;
    // End of variables declaration//GEN-END:variables
}

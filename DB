CREATE TABLE nguoi_dung (
	id INTEGER NOT NULL IDENTITY UNIQUE,
	ten_dang_nhap VARCHAR(255) NOT NULL UNIQUE,
	email VARCHAR(255) NOT NULL,
	vai_tro VARCHAR(255) NOT NULL,
	ngay_tao DATETIME NOT NULL,
	PRIMARY KEY(id)
);

CREATE TABLE thong_tin_ca_nhan (
	ma_thong_tin INTEGER NOT NULL IDENTITY UNIQUE,
	nguoi_dung_id INTEGER NOT NULL,
	ho NVARCHAR(255) NOT NULL,
	ten NVARCHAR(255) NOT NULL,
	ngay_sinh DATE NOT NULL,
	gioi_tinh NVARCHAR(255) NOT NULL,
	dia_chi NVARCHAR(255) NOT NULL,
	so_dien_thoai VARCHAR(255) NOT NULL UNIQUE,
	so_cong_dan VARCHAR(255) NOT NULL UNIQUE,
	so_tai_khoan VARCHAR(255) NOT NULL UNIQUE,
	PRIMARY KEY(ma_thong_tin),
	FOREIGN KEY(nguoi_dung_id) REFERENCES nguoi_dung(id)
	ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE TABLE loai_the (
	id VARCHAR(255) PRIMARY KEY(id),
	ten_loai_the NVARCHAR(255) not null
);

CREATE TABLE the_nguoi_dung (
	id INTEGER NOT NULL IDENTITY UNIQUE,
	nguoi_dung_id INTEGER NOT NULL,
	loai_the_id VARCHAR(255) NOT NULL,
	so_the VARCHAR(255) NOT NULL UNIQUE,
	ngay_het_han DATE NOT NULL,
	trang_thai NVARCHAR(255) NOT NULL,
	ngay_tao DATETIME NOT NULL,
	PRIMARY KEY(id),
	FOREIGN KEY(nguoi_dung_id) REFERENCES nguoi_dung(id)
	ON UPDATE NO ACTION ON DELETE CASCADE,
	FOREIGN KEY(loai_the_id) REFERENCES loai_the(id)
	ON UPDATE NO ACTION ON DELETE CASCADE
);


CREATE TABLE giao_dich (
	id INTEGER NOT NULL IDENTITY UNIQUE,
	nguoi_dung_id INTEGER NOT NULL,
	loai_giao_dich VARCHAR(255) NOT NULL,
	ten_nguoi_nhan VARCHAR(255) NOT NULL,
	so_tai_khoan_nguoi_nhan VARCHAR(255) NOT NULL,
	so_tien DECIMAL NOT NULL,
	mo_ta NTEXT NOT NULL,
	ngay_giao_dich TIMESTAMP NOT NULL,
	trang_thai VARCHAR(255) NOT NULL,
	PRIMARY KEY(id),
	FOREIGN KEY(nguoi_dung_id) REFERENCES nguoi_dung(id)
	ON UPDATE NO ACTION ON DELETE CASCADE
);

CREATE TABLE tiet_kiem (
	id INTEGER NOT NULL IDENTITY UNIQUE,
	nguoi_dung_id INTEGER NOT NULL,
	ten_tiet_kiem NVARCHAR(255) NOT NULL,
	mo_ta_tiet_kiem NTEXT,
	so_tien_du_dinh DECIMAL NOT NULL,
	so_tien_hien_co DECIMAL NOT NULL,
	ngay_bat_dau DATE NOT NULL,
	ngay_ket_thuc DATETIME NOT NULL,
	ngay_tao DATETIME NOT NULL,
	PRIMARY KEY(id),
	FOREIGN KEY(nguoi_dung_id) REFERENCES nguoi_dung(id)
	ON UPDATE NO ACTION ON DELETE CASCADE
);

CREATE TABLE thong_bao (
	id INTEGER NOT NULL IDENTITY UNIQUE,
	nguoi_dung_id INTEGER NOT NULL,
	noi_dung NTEXT NOT NULL,
	loai_thong_bao NVARCHAR(255) NOT NULL,
	ngay_tao DATETIME NOT NULL,
	PRIMARY KEY(id),
	FOREIGN KEY(nguoi_dung_id) REFERENCES nguoi_dung(id)
	ON UPDATE NO ACTION ON DELETE CASCADE
);

CREATE TABLE uu_dai (
	id INTEGER NOT NULL IDENTITY UNIQUE,
	doi_tuong_the_id VARCHAR(255) NOT NULL,
	ten_uu_dai NVARCHAR(255) NOT NULL,
	mo_ta NTEXT NOT NULL,
	ngay_hieu_luc DATETIME NOT NULL,
	ngay_het_han DATETIME NOT NULL,
	PRIMARY KEY(id),
	FOREIGN KEY(doi_tuong_the_id) REFERENCES loai_the(id)
	ON UPDATE NO ACTION ON DELETE CASCADE
);

CREATE TABLE ho_tro_nguoi_dung (
	id INTEGER NOT NULL IDENTITY UNIQUE,
	nguoi_dung_id INTEGER NOT NULL,
	loai_yeu_cau VARCHAR(255) NOT NULL,
	mo_ta NTEXT NOT NULL,
	trang_thai VARCHAR(255) NOT NULL,
	ngay_tao DATETIME NOT NULL,
	ngay_xu_ly DATETIME,
	PRIMARY KEY(id),
	FOREIGN KEY(nguoi_dung_id) REFERENCES nguoi_dung(id)
	ON UPDATE NO ACTION ON DELETE CASCADE
);

CREATE TABLE lich_su_giao_dich (
	id INTEGER NOT NULL IDENTITY UNIQUE,
	giao_dich_id INTEGER NOT NULL,
	nguoi_dung_id INTEGER NOT NULL,
	PRIMARY KEY(id),
	FOREIGN KEY(giao_dich_id) REFERENCES giao_dich(id)
	ON UPDATE NO ACTION ON DELETE CASCADE,
	FOREIGN KEY(nguoi_dung_id) REFERENCES nguoi_dung(id)
	ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE TABLE khoan_vay (
    id INT PRIMARY KEY IDENTITY,  
    nguoi_dung_id INT,                              
    loai_vay NVARCHAR(255),                      
    so_tien_vay DECIMAL(15, 2),
    so_tien_da_tra DECIMAL(15, 2),
    so_tien_con_lai DECIMAL(15, 2),                                    
    ngay_bat_dau DATE,                          
    ngay_ket_thuc DATE,                         
    tinh_trang NVARCHAR(255),                    
    ngay_tao DATETIME DEFAULT GETDATE(),
    FOREIGN KEY(nguoi_dung_id) REFERENCES nguoi_dung(id)
    ON UPDATE NO ACTION ON DELETE CASCADE    
);
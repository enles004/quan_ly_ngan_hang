CREATE TABLE nguoi_dung (
	id INTEGER NOT NULL IDENTITY UNIQUE,
	ten_dang_nhap VARCHAR NOT NULL UNIQUE,
	email VARCHAR NOT NULL,
	vai_tro VARCHAR NOT NULL,
	ngay_tao TIMESTAMP NOT NULL,
	PRIMARY KEY(id)
);

CREATE TABLE thong_tin_ca_nhan (
	ma_thong_tin INTEGER NOT NULL IDENTITY UNIQUE,
	nguoi_dung_id INTEGER NOT NULL,
	ho NVARCHAR NOT NULL,
	ten NVARCHAR NOT NULL,
	ngay_sinh DATE NOT NULL,
	dia_chi NVARCHAR NOT NULL,
	so_dien_thoai VARCHAR NOT NULL UNIQUE,
	so_cong_dan VARCHAR NOT NULL UNIQUE,
	so_tai_khoan VARCHAR NOT NULL UNIQUE,
	PRIMARY KEY(ma_thong_tin),
	FOREIGN KEY(nguoi_dung_id) REFERENCES nguoi_dung(id)
	ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE TABLE loai_the (
	id VARCHAR NOT NULL UNIQUE,
	PRIMARY KEY(id)
);

CREATE TABLE the_nguoi_dung (
	id INTEGER NOT NULL IDENTITY UNIQUE,
	nguoi_dung_id INTEGER NOT NULL,
	loai_the_id VARCHAR NOT NULL,
	so_the VARCHAR NOT NULL UNIQUE,
	ngay_het_han DATE NOT NULL,
	trang_thai NVARCHAR NOT NULL,
	ngay_tao TIMESTAMP NOT NULL,
	PRIMARY KEY(id),
	FOREIGN KEY(nguoi_dung_id) REFERENCES nguoi_dung(id)
	ON UPDATE NO ACTION ON DELETE CASCADE,
	FOREIGN KEY(loai_the_id) REFERENCES loai_the(id)
	ON UPDATE NO ACTION ON DELETE CASCADE
);


CREATE TABLE giao_dich (
	id INTEGER NOT NULL IDENTITY UNIQUE,
	nguoi_dung_id INTEGER NOT NULL,
	loai_giao_dich VARCHAR NOT NULL,
	ten_nguoi_nhan VARCHAR NOT NULL,
	so_tai_khoan_nguoi_nhan VARCHAR NOT NULL,
	so_tien DECIMAL NOT NULL,
	mo_ta NTEXT NOT NULL,
	ngay_giao_dich TIMESTAMP NOT NULL,
	trang_thai VARCHAR NOT NULL,
	PRIMARY KEY(id),
	FOREIGN KEY(nguoi_dung_id) REFERENCES nguoi_dung(id)
	ON UPDATE NO ACTION ON DELETE CASCADE
);

CREATE TABLE tiet_kiem (
	id INTEGER NOT NULL IDENTITY UNIQUE,
	nguoi_dung_id INTEGER NOT NULL,
	ten_tiet_kiem NVARCHAR NOT NULL,
	mo_ta_tiet_kiem NTEXT,
	so_tien_du_dinh DECIMAL NOT NULL,
	so_tien_hien_co DECIMAL NOT NULL,
	ngay_bat_dau DATE NOT NULL,
	ngay_ket_thuc DATETIME NOT NULL,
	ngay_tao TIMESTAMP NOT NULL,
	PRIMARY KEY(id),
	FOREIGN KEY(nguoi_dung_id) REFERENCES nguoi_dung(id)
	ON UPDATE NO ACTION ON DELETE CASCADE
);

CREATE TABLE thong_bao (
	id INTEGER NOT NULL IDENTITY UNIQUE,
	nguoi_dung_id INTEGER NOT NULL,
	noi_dung NTEXT NOT NULL,
	loai_thong_bao NVARCHAR NOT NULL,
	ngay_tao TIMESTAMP NOT NULL,
	PRIMARY KEY(id),
	FOREIGN KEY(nguoi_dung_id) REFERENCES nguoi_dung(id)
	ON UPDATE NO ACTION ON DELETE CASCADE
);

CREATE TABLE uu_dai (
	id INTEGER NOT NULL IDENTITY UNIQUE,
	doi_tuong_the_id VARCHAR NOT NULL,
	ten_uu_dai NVARCHAR NOT NULL,
	mo_ta NTEXT NOT NULL,
	ngay_hieu_luc DATETIME NOT NULL,
	ngay_het_han DATETIME NOT NULL,
	PRIMARY KEY(id),
	FOREIGN KEY(doi_tuong_the_id) REFERENCES loai_the(id)
	ON UPDATE NO ACTION ON DELETE CASCADE
);

CREATE TABLE ho_tro_nguoi_dung (
	id INTEGER NOT NULL IDENTITY UNIQUE,
	nguoi_dung_id INTEGER NOT NULL,
	loai_yeu_cau VARCHAR NOT NULL,
	mo_ta NTEXT NOT NULL,
	trang_thai VARCHAR NOT NULL,
	ngay_tao DATETIME NOT NULL,
	ngay_xu_ly DATETIME,
	PRIMARY KEY(id),
	FOREIGN KEY(nguoi_dung_id) REFERENCES nguoi_dung(id)
	ON UPDATE NO ACTION ON DELETE CASCADE
);

CREATE TABLE lich_su_giao_dich (
	id INTEGER NOT NULL IDENTITY UNIQUE,
	giao_dich_id INTEGER NOT NULL,
	nguoi_dung_id INTEGER NOT NULL,
	PRIMARY KEY(id),
	FOREIGN KEY(giao_dich_id) REFERENCES giao_dich(id)
	ON UPDATE NO ACTION ON DELETE CASCADE,
	FOREIGN KEY(nguoi_dung_id) REFERENCES nguoi_dung(id)
	ON UPDATE NO ACTION ON DELETE NO ACTION
);
